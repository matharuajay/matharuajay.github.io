I"Ä<p>Its been very long since I have written any technical post. So here I am, with small example of how to insert data from XML into SQL. This is extremely helpful if you want to insert multiple records in one go into SQL, you just need to create the XML and pass it to SQL. SQL will fetch the data from the XML and save it into its tables you have mapped.</p>

<p>Just to demonstrate I am creating a sample table. Since it is sample I have not created any Primary Key on it.</p>

<pre class="sql" name="code">CREATE TABLE [dbo].[Employees](
	[EmpId] [int] NOT NULL,
	[FirstName] [varchar](50) NULL,
	[Dept] [varchar](50) NULL
)
</pre>

<p>Once table has been created you are ready to insert data into it,</p>

<pre class="sql" name="code">declare @TestDoc int
declare @TestDoc int
exec sp_xml_preparedocument @TestDoc output,
N'&lt;Root&gt;
&lt;Employees Dept="Marketing"&gt;
&lt;Employee EmpID="1231" FirstName="Ethan"&gt;&lt;/Employee&gt;
&lt;Employee EmpID="1232" FirstName="Ashish"&gt;&lt;/Employee&gt;
&lt;/Employees&gt;
&lt;Employees Dept="IT"&gt;
&lt;Employee EmpID="1241" FirstName="Ajay"&gt;&lt;/Employee&gt;
&lt;Employee EmpID="1242" FirstName="Rahul"&gt;&lt;/Employee&gt;
&lt;/Employees&gt;
&lt;Employees Dept="DBA"&gt;
&lt;Employee EmpID="1251" FirstName="AJ"&gt;&lt;/Employee&gt;
&lt;Employee EmpID="1251" FirstName="Nilesh"&gt;&lt;/Employee&gt;
&lt;/Employees&gt;
&lt;/Root&gt;'
insert into employees(empid, firstname, dept)
select empid, firstname, dept
from openxml(@TestDoc, N'/Root/Employees/Employee')
With (EmpId varchar(5) '@EmpID',
    FirstName varchar(10) '@FirstName',
    Dept varchar(10) '../@Dept')
exec sp_xml_removedocument @TestDoc
</pre>

<p>Alternatively, you can change your XML format like this,</p>

<pre class="sql" name="code">declare @TestDoc int
exec sp_xml_preparedocument @TestDoc output,
N'&lt;Root&gt;
&lt;Employees Dept="Marketing"&gt;
&lt;Employee EmpID="1231"&gt;Ethans&lt;/Employee&gt;
&lt;Employee EmpID="1232"&gt;Ajay&lt;/Employee&gt;
&lt;/Employees&gt;
&lt;Employees Dept="IT"&gt;
&lt;Employee EmpID="1241"&gt;Rahul&lt;/Employee&gt;
&lt;Employee EmpID="1242"&gt;Sneha&lt;/Employee&gt;
&lt;/Employees&gt;
&lt;Employees Dept="DBA"&gt;
&lt;Employee EmpID="1251"&gt;Nilesh&lt;/Employee&gt;
&lt;Employee EmpID="1251"&gt;Matharu&lt;/Employee&gt;
&lt;/Employees&gt;
&lt;/Root&gt;'
select *
from openxml(@TestDoc, N'/Root/Employees/Employee')
With (EmpId varchar(5) '@EmpID',
    FirstName varchar(10) '.',
    Dept varchar(10) '../@Dept')
exec sp_xml_removedocument @TestDoc
</pre>

<p>If you want to fetch your existing data from SQL in XML format,</p>

<p>With values as attributes,</p>

<pre class="sql" name="code">select * from employees
for xml auto
</pre>

<div id="attachment_2189" style="width: 574px" class="wp-caption aligncenter">
  <img class="size-full wp-image-2189" title="Output Data as Attributes" src="http://www.ajaymatharu.com/wp-content/uploads/2010/03/Data-as-attribute.png" alt="Output Data as Attributes" width="564" height="119" srcset="http://www.ajaymatharu.com/wp-content/uploads/2010/03/Data-as-attribute-300x63.png 300w, http://www.ajaymatharu.com/wp-content/uploads/2010/03/Data-as-attribute.png 564w" sizes="(max-width: 564px) 100vw, 564px" />
  
  <p class="wp-caption-text">
    Output Data as Attributes
  </p>
</div>

<p>With values as elements,</p>

<pre class="sql" name="code">select * from employees
for xml auto, elements
</pre>

<div id="attachment_2190" style="width: 319px" class="wp-caption aligncenter">
  <img class="size-full wp-image-2190" title="Output Data as Elements" src="http://www.ajaymatharu.com/wp-content/uploads/2010/03/data-as-elements.png" alt="Output Data as Elements" width="309" height="519" />
  
  <p class="wp-caption-text">
    Output Data as Elements
  </p>
</div>
:ET